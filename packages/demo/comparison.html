<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CrossfilterX vs Crossfilter Comparison</title>
    <style>
      :root {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        background: #0f172a;
        color: #e2e8f0;
      }
      body {
        margin: 0;
        padding: 2rem;
        max-width: 1800px;
        margin: 0 auto;
      }
      h1 {
        margin: 0 0 0.5rem;
        font-size: 2rem;
        font-weight: 700;
      }
      .subtitle {
        opacity: 0.7;
        margin-bottom: 2rem;
        font-size: 0.95rem;
      }

      .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .implementation-section {
        background: rgba(30, 41, 59, 0.5);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.1);
      }

      .implementation-section h2 {
        margin: 0 0 1rem;
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-weight: 600;
      }

      .badge.new {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
        border: 1px solid #10b981;
      }

      .badge.original {
        background: rgba(56, 189, 248, 0.2);
        color: #38bdf8;
        border: 1px solid #38bdf8;
      }

      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .metric-card {
        background: rgba(15, 23, 42, 0.6);
        padding: 0.75rem;
        border-radius: 8px;
      }

      .metric-card span {
        display: block;
        font-size: 0.7rem;
        opacity: 0.7;
        margin-bottom: 0.25rem;
      }

      .metric-card strong {
        font-size: 1.25rem;
        font-weight: 700;
      }

      .metric-card.winner {
        border: 1px solid #10b981;
        background: rgba(16, 185, 129, 0.1);
      }

      .chart-container {
        background: rgba(15, 23, 42, 0.4);
        padding: 0.75rem;
        border-radius: 8px;
        margin-bottom: 0.75rem;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .chart-header h3 {
        margin: 0;
        font-size: 0.85rem;
        font-weight: 600;
        color: #cbd5e1;
      }

      canvas {
        width: 100%;
        height: 120px;
        border-radius: 6px;
        cursor: crosshair;
        display: block;
      }

      .controls {
        background: rgba(30, 41, 59, 0.5);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.1);
        margin-bottom: 2rem;
      }

      .button-group {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      button {
        background: rgba(56, 189, 248, 0.2);
        border: 1px solid #38bdf8;
        color: #38bdf8;
        font-size: 0.85rem;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }

      button:hover {
        background: rgba(56, 189, 248, 0.3);
      }

      button.danger {
        border-color: #f87171;
        color: #f87171;
        background: rgba(248, 113, 113, 0.2);
      }

      button.danger:hover {
        background: rgba(248, 113, 113, 0.3);
      }

      button.success {
        border-color: #10b981;
        color: #10b981;
        background: rgba(16, 185, 129, 0.2);
      }

      button.success:hover {
        background: rgba(16, 185, 129, 0.3);
      }

      .test-results {
        background: rgba(30, 41, 59, 0.5);
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.1);
      }

      .test-results h2 {
        margin: 0 0 1rem;
        font-size: 1.25rem;
      }

      .test-item {
        background: rgba(15, 23, 42, 0.6);
        padding: 0.75rem;
        border-radius: 6px;
        margin-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .test-item .status {
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .test-item .status.pass {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
      }

      .test-item .status.fail {
        background: rgba(248, 113, 113, 0.2);
        color: #f87171;
      }

      @media (max-width: 1200px) {
        .comparison-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <h1>CrossfilterX vs Crossfilter Comparison</h1>
    <p class="subtitle">
      Side-by-side performance and behavior comparison to validate drop-in replacement compatibility
    </p>

    <div class="controls">
      <h2 style="margin: 0 0 1rem; font-size: 1.1rem;">Test Controls</h2>
      <div class="button-group">
        <button id="test-rapid-filter" class="success">Run Rapid Filter Test</button>
        <button id="test-concurrent" class="success">Run Concurrent Ops Test</button>
        <button id="test-memory" class="success">Run Memory Test</button>
        <button id="reset-all" class="danger">Reset All</button>
      </div>
    </div>

    <div class="comparison-grid">
      <!-- CrossfilterX Section -->
      <div class="implementation-section">
        <h2>
          CrossfilterX
          <span class="badge new">NEW</span>
        </h2>

        <div class="metrics">
          <div class="metric-card" id="cfx-ingest-metric">
            <span>Ingest Time</span>
            <strong data-metric="cfx-ingest">–</strong>
          </div>
          <div class="metric-card" id="cfx-filter-metric">
            <span>Filter Time</span>
            <strong data-metric="cfx-filter">–</strong>
          </div>
          <div class="metric-card">
            <span>Total Rows</span>
            <strong data-summary="cfx-total">–</strong>
          </div>
          <div class="metric-card">
            <span>Active Rows</span>
            <strong data-summary="cfx-active">–</strong>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3>Hour of Day</h3>
          </div>
          <canvas width="400" height="120" data-chart="cfx-hour"></canvas>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3>Delay (minutes)</h3>
          </div>
          <canvas width="400" height="120" data-chart="cfx-delay"></canvas>
        </div>
      </div>

      <!-- Original Crossfilter Section -->
      <div class="implementation-section">
        <h2>
          Crossfilter (Original)
          <span class="badge original">BASELINE</span>
        </h2>

        <div class="metrics">
          <div class="metric-card" id="cf-ingest-metric">
            <span>Ingest Time</span>
            <strong data-metric="cf-ingest">–</strong>
          </div>
          <div class="metric-card" id="cf-filter-metric">
            <span>Filter Time</span>
            <strong data-metric="cf-filter">–</strong>
          </div>
          <div class="metric-card">
            <span>Total Rows</span>
            <strong data-summary="cf-total">–</strong>
          </div>
          <div class="metric-card">
            <span>Active Rows</span>
            <strong data-summary="cf-active">–</strong>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3>Hour of Day</h3>
          </div>
          <canvas width="400" height="120" data-chart="cf-hour"></canvas>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3>Delay (minutes)</h3>
          </div>
          <canvas width="400" height="120" data-chart="cf-delay"></canvas>
        </div>
      </div>
    </div>

    <div class="test-results">
      <h2>Test Results</h2>
      <div id="test-results-container">
        <p style="opacity: 0.6;">Run tests to see results...</p>
      </div>
    </div>

    <script type="module" src="/src/comparison-main.ts"></script>
  </body>
</html>
